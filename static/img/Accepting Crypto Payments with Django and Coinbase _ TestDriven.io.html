<!DOCTYPE html>
<!-- saved from url=(0043)https://testdriven.io/blog/django-coinbase/ -->
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover">

    <title>Accepting Crypto Payments with Django and Coinbase | TestDriven.io</title>

    <meta property="og:url" content="https://testdriven.io/blog/django-coinbase/">

    

<meta property="og:title" content="Accepting Crypto Payments with Django and Coinbase">
<meta name="description" property="og:description" content="This tutorial looks at how to accept crypto Payments with Django and Coinbase Commerce.">
<meta name="keywords" content="coinbase commerce, coinbase commerce api, accept crypto payments, crypto payments django, bitcoin payments django, django payments, django payment processing">
<meta property="og:image" content="https://testdriven.io/static/images/blog/django/django-coinbase/django_coinbase_social_card.png">
<meta property="og:image:alt" content="A white rectangle displaying the article title, &quot;Accepting Crypto Payments with Django and Coinbase&quot;, and a byline featuring Nik Tomazic.">
<meta name="twitter:image" content="https://testdriven.io/static/images/blog/django/django-coinbase/django_coinbase_social_card.png">
<meta property="twitter:image:alt" content="A white rectangle displaying the article title, &quot;Accepting Crypto Payments with Django and Coinbase&quot;, and a byline featuring Nik Tomazic.">



<script type="text/javascript" async="" src="./Accepting Crypto Payments with Django and Coinbase _ TestDriven.io_files/js"></script><script async="true" type="text/javascript" src="./Accepting Crypto Payments with Django and Coinbase _ TestDriven.io_files/analytics.js.download"></script><script gtm="GTM-57PX49D" async="true" type="text/javascript" src="./Accepting Crypto Payments with Django and Coinbase _ TestDriven.io_files/optimize.js.download"></script><script src="./Accepting Crypto Payments with Django and Coinbase _ TestDriven.io_files/516228106408212" async=""></script><script async="" src="./Accepting Crypto Payments with Django and Coinbase _ TestDriven.io_files/fbevents.js.download"></script><script async="" src="./Accepting Crypto Payments with Django and Coinbase _ TestDriven.io_files/gtm.js.download"></script><script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "TechArticle",

  "headline": "Accepting Crypto Payments with Django and Coinbase",
  "proficiencyLevel": "Expert",

  "url": "https://testdriven.io/blog/django-coinbase/",
  "mainEntityOfPage": {
      "@type": "WebPage",
      "@id": "https://testdriven.io/blog/django-coinbase/"
    },

  "datePublished": "2021-10-14T22:28:15+00:00",
  "dateModified": "2021-10-14T22:28:15+00:00",

  "image": [
      "https://testdriven.io/static/images/structured-data/1x1.de738cd68eed.png",
      "https://testdriven.io/static/images/structured-data/4x3.7babd5c1a5d2.png",
      "https://testdriven.io/static/images/structured-data/16x9.722e0a50d594.png"
  ],

  "keywords": "coinbase commerce, coinbase commerce api, accept crypto payments, crypto payments django, bitcoin payments django, django payments, django payment processing",
  "publisher": {
    "@type": "Organization",
    "name:": "TestDriven.io",
    "legalName": "TestDriven Labs, LLC",
    "logo": {
      "@type": "ImageObject",
      "url": "https://testdriven.io/static/images/structured-data/publisher-logo.26c339391c89.png",
      "caption": "TestDriven.io"
    }
  },
  "author": {
    "@type": "Person",
    "name": "Nik Tomazic"
  },
  "editor": {
    "@type": "Person",
    "name": "Michael Herman"
  },

  "description": "This tutorial looks at how to accept crypto Payments with Django and Coinbase Commerce."

  
  }
</script>



    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="@testdrivenio">
    <meta name="facebook-domain-verification" content="6de2le6kpmclafnruk9qr58mpil5rl">
    
    

    <link rel="shortcut icon" type="image/png" href="https://testdriven.io/static/images/favicon.419dfe6cb3f6.png">

    
      <!-- Google Tag Manager -->
      <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
      new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
      })(window,document,'script','dataLayer','GTM-57PX49D');</script>
      <!-- End Google Tag Manager -->

      <!-- Google and Facebook/Meta Ads -->
      <!-- Global site tag (gtag.js) - Google Ads: 360133586 -->
<script async="" src="./Accepting Crypto Payments with Django and Coinbase _ TestDriven.io_files/js(1)"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'AW-360133586');
</script>
<!-- Meta Pixel Code -->
<script>
  !function(f,b,e,v,n,t,s)
  {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
  n.callMethod.apply(n,arguments):n.queue.push(arguments)};
  if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
  n.queue=[];t=b.createElement(e);t.async=!0;
  t.src=v;s=b.getElementsByTagName(e)[0];
  s.parentNode.insertBefore(t,s)}(window, document,'script',
  'https://connect.facebook.net/en_US/fbevents.js');
  fbq('init', '516228106408212');
  fbq('track', 'PageView');
</script>
<noscript><img height="1" width="1" style="display:none"
  src="https://www.facebook.com/tr?id=516228106408212&ev=PageView&noscript=1"
/></noscript>
<!-- End Meta Pixel Code -->

    

    <!-- CSS Styles -->
    <link href="./Accepting Crypto Payments with Django and Coinbase _ TestDriven.io_files/all.css" rel="stylesheet">

    <link rel="stylesheet" href="./Accepting Crypto Payments with Django and Coinbase _ TestDriven.io_files/main.744e2a294bd2.css">
    <link rel="stylesheet" href="./Accepting Crypto Payments with Django and Coinbase _ TestDriven.io_files/pygments.7262fcc7e9ed.css">

    
      <link rel="stylesheet" href="./Accepting Crypto Payments with Django and Coinbase _ TestDriven.io_files/pygments_error.bbadc7ab2566.css">
    

    

    
  <meta http-equiv="origin-trial" content="AymqwRC7u88Y4JPvfIF2F37QKylC04248hLCdJAsh8xgOfe/dVJPV3XS3wLFca1ZMVOtnBfVjaCMTVudWM//5g4AAAB7eyJvcmlnaW4iOiJodHRwczovL3d3dy5nb29nbGV0YWdtYW5hZ2VyLmNvbTo0NDMiLCJmZWF0dXJlIjoiUHJpdmFjeVNhbmRib3hBZHNBUElzIiwiZXhwaXJ5IjoxNjk1MTY3OTk5LCJpc1RoaXJkUGFydHkiOnRydWV9"><script async="true" type="text/javascript" src="./Accepting Crypto Payments with Django and Coinbase _ TestDriven.io_files/f.txt"></script><script charset="utf-8" src="./Accepting Crypto Payments with Django and Coinbase _ TestDriven.io_files/button.e7f9415a2e000feaab02c86dd5802747.js.download"></script></head>
  <body class=" page-blog page-blog-detail">

    
      <!-- Google Tag Manager (noscript) -->
      <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-57PX49D"
      height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
      <!-- End Google Tag Manager (noscript) -->
    

    <!-- Nav -->
    
      
        


<nav class="navbar navbar-expand-lg navbar-dark bg-dark sticky-top">
  <a class="navbar-brand" href="https://testdriven.io/">
    <img class="nav-logo" src="./Accepting Crypto Payments with Django and Coinbase _ TestDriven.io_files/test_driven_io_full_logo_white_text.4a6302a91a54.svg" alt="testdriven.io">
  </a>
  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarsExampleDefault" aria-controls="navbarsExampleDefault" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>
  <div class="collapse navbar-collapse" id="navbarsExampleDefault">
    <!-- left -->
    <ul class="navbar-nav mr-auto">
      <li class="nav-item dropdown">
        <a class="nav-link" href="https://testdriven.io/courses/">Courses</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="https://testdriven.io/bundles/">Bundles</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="https://testdriven.io/blog/">Blog</a>
      </li>
      <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle" href="https://testdriven.io/blog/django-coinbase/#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
          Guides
        </a>
        <div class="dropdown-menu" aria-labelledby="navbarDropdown">
          <a class="dropdown-item" href="https://testdriven.io/guides/complete-python/">Complete Python</a>
          <a class="dropdown-item" href="https://testdriven.io/guides/django-celery/">Django and Celery</a>
          <a class="dropdown-item" href="https://testdriven.io/guides/flask-deep-dive/">Deep Dive Into Flask</a>
        </div>
      </li>
      <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle" href="https://testdriven.io/blog/django-coinbase/#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
          More
        </a>
        <div class="dropdown-menu" aria-labelledby="navbarDropdown">
          <a class="dropdown-item" href="https://testdriven.io/support/">Support and Consulting</a>
          <a class="dropdown-item" href="https://testdriven.io/test-driven-development/">What is Test-Driven Development?</a>
          <a class="dropdown-item" href="https://testdriven.io/testimonials/">Testimonials</a>
          <a class="dropdown-item" href="https://testdriven.io/opensource/">Open Source Donations</a>
          <a class="dropdown-item" href="https://testdriven.io/about/">About Us</a>
          <a class="dropdown-item" href="https://testdriven.io/authors/">Meet the Authors</a>
          <a class="dropdown-item" href="https://testdriven.io/tips/">Tips and Tricks</a>
        </div>
      </li>
    </ul>
    <!-- right - NOT included in hamburger menu -->
    <ul class="navbar-nav flex-row ml-lg-auto d-none d-lg-flex">
      <span class="ml-lg-auto d-none d-lg-flex">
        <li class="nav-item">
          <a class="nav-link" href="https://twitter.com/testdrivenio" data-a-social-outbound="Twitter"><i class="fab fa-twitter"></i></a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="https://github.com/testdrivenio" data-a-social-outbound="GitHub"><i class="fab fa-github"></i></a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="https://testdriven.io/feeds/"><i class="fas fa-rss"></i></a>
        </li>
      </span>
      
      <li class="nav-item nav-right-btn">
        <a class="btn btn-primary" href="https://testdriven.io/accounts/login/?next=/blog/django-coinbase/" data-a-nav-signin="">Sign In</a>
        <a class="btn btn-brand1" href="https://testdriven.io/accounts/signup/?next=/blog/django-coinbase/" data-a-nav-signup="">Sign Up</a>
      </li>
      
    </ul>
    <!-- right - included in hamburger menu -->
    <ul class="navbar-nav d-lg-none">
      
      <li class="nav-item">
        <a class="nav-link" href="https://testdriven.io/accounts/login/" data-a-nav-signin="">Sign In</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="https://testdriven.io/accounts/signup/" data-a-nav-signup="">Sign Up</a>
      </li>
      
    </ul>
  </div>
</nav>

      
    

    <!-- Main Content -->
    
      

<header class="hero blog-hero blog-detail-hero">
  <div class="container">
    <div class="row">
      <div class="col blog-detail-header">
        <h1>Accepting Crypto Payments with Django and Coinbase</h1>

        <span class="blog-detail-byline">
          <span class="sr-only">Posted by</span>
          
            <a href="https://testdriven.io/authors/tomazic/" class="author-line big">
              <img src="./Accepting Crypto Payments with Django and Coinbase _ TestDriven.io_files/tomazic.png" alt="Nik Tomazic" class="author-line-photo rounded-circle">
              Nik Tomazic
            </a>
          
        </span>

        <span class="blog-detail-date">
          Last updated
          October 14th, 2021
        </span>
      </div>
    </div>
  </div>
</header>


<main>
  <div class="container blog-container" style="padding-top: 0;">
    <div class="row">
      <div class="col col-12 col-lg-8">
        
  

  
  
  
    <section class="social-share">
  <h2 class="social-share-heading sr-only">Share this tutorial</h2>
  <ul>
    <li>
      
        <a class="btn social-share-link twitter" href="https://twitter.com/intent/tweet/?text=Accepting%20Crypto%20Payments%20with%20Django%20and%20Coinbase%20from%20%40TestDrivenio&amp;url=https%3A//testdriven.io/blog/django-coinbase/" target="_blank" rel="noopener" aria-label="Twitter" data-a-social-share="Twitter">
        <span aria-hidden="true">
          <i class="fab fa-twitter"></i>
          <span class="label">Twitter</span>
        </span>
      </a>
      
    </li>

    <li>
      <a class="btn social-share-link reddit" href="https://reddit.com/submit/?url=https%3A//testdriven.io/blog/django-coinbase/&amp;resubmit=true&amp;title=Accepting%20Crypto%20Payments%20with%20Django%20and%20Coinbase" target="_blank" rel="noopener" aria-label="Reddit" data-a-social-share="Reddit">
        <span aria-hidden="true">
          <i class="fab fa-reddit-alien"></i>
          <span class="label">Reddit</span>
        </span>
      </a>
    </li>

    <li>
      <a class="btn social-share-link hackernews" href="https://news.ycombinator.com/submitlink?u=https%3A//testdriven.io/blog/django-coinbase/&amp;t=Accepting%20Crypto%20Payments%20with%20Django%20and%20Coinbase" target="_blank" rel="noopener" aria-label="Hacker News" data-a-social-share="HackerNews">
        <span aria-hidden="true">
          <i class="fab fa-hacker-news"></i>
          <span class="label">Hacker News</span>
        </span>
      </a>
    </li>

    <li>
      <a class="btn social-share-link facebook" href="https://facebook.com/sharer/sharer.php?u=https%3A//testdriven.io/blog/django-coinbase/" target="_blank" rel="noopener" aria-label="Facebook" data-a-social-share="Facebook">
          <span aria-hidden="true">
          <i class="fab fa-facebook-square" aria-hidden="true"></i>
          <span class="label">Facebook</span>
          </span>
      </a>
    </li>
  </ul>
</section>

  
  
  

  <div class="blog-content long-content" data-local-nav-source="">
    <p>In this tutorial, we'll integrate Django with <a href="https://commerce.coinbase.com/">Coinbase Commerce</a> to accept different crypto payments. We'll look at two different approaches: <a href="https://commerce.coinbase.com/docs/api/#charges">Coinbase Charges</a> and <a href="https://commerce.coinbase.com/docs/api/#checkouts">Coinbase Checkout</a>.</p>
<h2 class="toc-header">Contents</h2>

<div class="toc">
<ul>
<li><a href="https://testdriven.io/blog/django-coinbase/#what-is-coinbase-commerce">What is Coinbase Commerce?</a></li>
<li><a href="https://testdriven.io/blog/django-coinbase/#project-setup" class="dropdown-toggle toggle-toc-0">Project Setup</a><ul style="display: none;">
<li><a href="https://testdriven.io/blog/django-coinbase/#django-project-setup">Django Project Setup</a></li>
<li><a href="https://testdriven.io/blog/django-coinbase/#add-coinbase-commerce">Add Coinbase Commerce</a></li>
</ul>
</li>
<li><a href="https://testdriven.io/blog/django-coinbase/#coinbase-charges" class="dropdown-toggle toggle-toc-1">Coinbase Charges</a><ul style="display: none;">
<li><a href="https://testdriven.io/blog/django-coinbase/#create-a-charge">Create a Charge</a></li>
<li><a href="https://testdriven.io/blog/django-coinbase/#create-the-redirect-views">Create the Redirect Views</a></li>
<li><a href="https://testdriven.io/blog/django-coinbase/#testing">Testing</a></li>
</ul>
</li>
<li><a href="https://testdriven.io/blog/django-coinbase/#coinbase-checkout" class="dropdown-toggle toggle-toc-2">Coinbase Checkout</a><ul style="display: none;">
<li><a href="https://testdriven.io/blog/django-coinbase/#create-a-checkout">Create a Checkout</a></li>
<li><a href="https://testdriven.io/blog/django-coinbase/#testing_1">Testing</a></li>
</ul>
</li>
<li><a href="https://testdriven.io/blog/django-coinbase/#confirm-payments-with-webhooks" class="dropdown-toggle toggle-toc-3">Confirm Payments with Webhooks</a><ul style="display: none;">
<li><a href="https://testdriven.io/blog/django-coinbase/#configure-the-endpoint">Configure the Endpoint</a></li>
<li><a href="https://testdriven.io/blog/django-coinbase/#identify-the-user">Identify the User</a></li>
<li><a href="https://testdriven.io/blog/django-coinbase/#register-the-endpoint">Register the Endpoint</a></li>
<li><a href="https://testdriven.io/blog/django-coinbase/#test-the-endpoint">Test the Endpoint</a></li>
</ul>
</li>
<li><a href="https://testdriven.io/blog/django-coinbase/#conclusion">Conclusion</a></li>
</ul>
</div>
<h2 id="what-is-coinbase-commerce">What is Coinbase Commerce?</h2>
<p><a href="https://commerce.coinbase.com/">Coinbase Commerce</a> is an enterprise digital payment service offered by <a href="https://www.coinbase.com/">Coinbase</a>, which allows merchants to accept crypto payments in different digital currencies. At the time of writing, they <a href="https://commerce.coinbase.com/faq#which-cryptocurrencies-can-i-accept-do-i-have-to-accept-all-of-the-cryptocurrencies-that-coinbase-commerce-offers">support</a> Bitcoin, Bitcoin Cash, DAI, Ethereum, Litecoin, Dogecoin, and USD Coin. Coinbase Commerce is easy to integrate into your web application and removes the hassle of dealing with crypto payments.</p>
<blockquote>
<p><a href="https://www.coinbase.com/">Coinbase</a> and <a href="https://commerce.coinbase.com/">Coinbase Commerce</a> are not the same thing. Coinbase is a crypto exchange and a wallet manager, while Coinbase Commerce is a digital payment service provider for merchants.</p>
</blockquote>
<p>The Coinbase Commerce API provides two different ways of accepting crypto payments: <a href="https://commerce.coinbase.com/docs/api/#charges">Coinbase Charges</a> and <a href="https://commerce.coinbase.com/docs/api/#checkouts">Coinbase Checkout</a>.</p>
<p>Advantages of Coinbase Charges:</p>
<ul>
<li>highly customizable</li>
<li>ability to programmatically attach metadata</li>
</ul>
<p>Advantages of Coinbase Checkout:</p>
<ul>
<li>works out of the box</li>
<li>dashboard product management</li>
<li>embedded checkout</li>
</ul>
<p>For most applications, we recommend the Charges API since it can be customized. This outweighs the simplicity that the Checkout API offers. If you're selling a fixed product and customization doesn't play a big role, feel free to use the Checkout API.</p>
<h2 id="project-setup">Project Setup</h2>
<p>In this tutorial, we'll show how to get both approaches, Coinbase Charges and Coinbase Checkout, up and running. We'll start with the same project setup for each. Once set up, feel free to follow one or both approaches.</p>
<h3 id="django-project-setup">Django Project Setup</h3>
<p>Start by creating a new directory and setting up a new Django project:</p>
<div class="codehilite"><pre><span></span><code>$ mkdir django-coinbase <span class="o">&amp;&amp;</span> <span class="nb">cd</span> django-coinbase
$ python3.9 -m venv env
$ <span class="nb">source</span> env/bin/activate

<span class="o">(</span>env<span class="o">)</span>$ pip install <span class="nv">django</span><span class="o">==</span><span class="m">3</span>.2.8
<span class="o">(</span>env<span class="o">)</span>$ django-admin startproject core .
</code></pre></div>

<p>After that, create a new app called <code>payments</code>:</p>
<div class="codehilite"><pre><span></span><code><span class="o">(</span>env<span class="o">)</span>$ python manage.py startapp payments
</code></pre></div>

<p>Register the app in <em>core/settings.py</em> under <code>INSTALLED_APPS</code>:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># core/settings.py</span>

<span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">'django.contrib.admin'</span><span class="p">,</span>
    <span class="s1">'django.contrib.auth'</span><span class="p">,</span>
    <span class="s1">'django.contrib.contenttypes'</span><span class="p">,</span>
    <span class="s1">'django.contrib.sessions'</span><span class="p">,</span>
    <span class="s1">'django.contrib.messages'</span><span class="p">,</span>
    <span class="s1">'django.contrib.staticfiles'</span><span class="p">,</span>
    <span class="s1">'payments.apps.PaymentsConfig'</span><span class="p">,</span> <span class="c1"># new</span>
<span class="p">]</span>
</code></pre></div>

<p>Add a simple functional view called <code>home_view</code> to <em>payments/views.py</em>:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># payments/views.py</span>

<span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">render</span>

<span class="k">def</span> <span class="nf">home_view</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">'home.html'</span><span class="p">,</span> <span class="p">{})</span>
</code></pre></div>

<p>Create a <em>urls.py</em> file inside the <code>payments</code> app:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># payments/urls.py</span>

<span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">path</span>

<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">views</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">''</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">home_view</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">'payments-home'</span><span class="p">),</span>
<span class="p">]</span>
</code></pre></div>

<p>Update the project-level URLs file with the <code>payments</code> app:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># core/urls.py</span>

<span class="kn">from</span> <span class="nn">django.contrib</span> <span class="kn">import</span> <span class="n">admin</span>
<span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">path</span><span class="p">,</span> <span class="n">include</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">''</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="s1">'payments.urls'</span><span class="p">)),</span> <span class="c1"># new</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">'admin/'</span><span class="p">,</span> <span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">urls</span><span class="p">),</span>
<span class="p">]</span>
</code></pre></div>

<p>Create a dedicated "templates" folder and a file for the homepage:</p>
<div class="codehilite"><pre><span></span><code><span class="o">(</span>env<span class="o">)</span>$ mkdir templates
<span class="o">(</span>env<span class="o">)</span>$ touch templates/home.html
</code></pre></div>

<p>Then, add the following HTML to <em>templates/home.html</em>:</p>
<div class="codehilite"><pre><span></span><code><span class="cm">&lt;!-- templates/home.html --&gt;</span>

<span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span> <span class="na">lang</span><span class="o">=</span><span class="s">"en"</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">"utf-8"</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">name</span><span class="o">=</span><span class="s">"viewport"</span> <span class="na">content</span><span class="o">=</span><span class="s">"width=device-width, initial-scale=1"</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Django + Coinbase<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">"stylesheet"</span> <span class="na">href</span><span class="o">=</span><span class="s">"https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/css/bootstrap.min.css"</span> <span class="na">crossorigin</span><span class="o">=</span><span class="s">"anonymous"</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">"https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/js/bootstrap.min.js"</span> <span class="na">crossorigin</span><span class="o">=</span><span class="s">"anonymous"</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">"container mt-5"</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">a</span> <span class="na">class</span><span class="o">=</span><span class="s">"btn btn-primary"</span> <span class="na">href</span><span class="o">=</span><span class="s">"#"</span><span class="p">&gt;</span>Purchase<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</code></pre></div>

<p>Make sure to update the settings.py file so Django knows to look for a "templates" folder:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># core/settings.py</span>

<span class="n">TEMPLATES</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span>
        <span class="s1">'BACKEND'</span><span class="p">:</span> <span class="s1">'django.template.backends.django.DjangoTemplates'</span><span class="p">,</span>
        <span class="s1">'DIRS'</span><span class="p">:</span> <span class="p">[</span><span class="s1">'templates'</span><span class="p">],</span> <span class="c1"># new</span>
        <span class="o">...</span>
</code></pre></div>

<p>Finally run <code>migrate</code> to sync the database and <code>runserver</code> to start Django's local web server:</p>
<div class="codehilite"><pre><span></span><code><span class="o">(</span>env<span class="o">)</span>$ python manage.py migrate
<span class="o">(</span>env<span class="o">)</span>$ python manage.py runserver
</code></pre></div>

<p>That's it! Open <a href="http://localhost:8000/">http://localhost:8000/</a> in your favorite browser. You should see the homepage:</p>
<p><img data-src="/static/images/blog/django/django-coinbase/homepage.png" loading="lazy" class="lazyload" style="max-width:100%" alt="Django + Coinbase Home Page" src="./Accepting Crypto Payments with Django and Coinbase _ TestDriven.io_files/homepage.png"></p>
<h3 id="add-coinbase-commerce">Add Coinbase Commerce</h3>
<p>Next, install <code>coinbase-commerce</code>:</p>
<div class="codehilite"><pre><span></span><code><span class="o">(</span>env<span class="o">)</span>$ pip install coinbase-commerce<span class="o">==</span><span class="m">1</span>.0.1
</code></pre></div>

<p>In order to work with the <a href="https://commerce.coinbase.com/docs/api/">Coinbase Commerce API</a>, you'll need to <a href="https://commerce.coinbase.com/signup">create an account</a> (if you haven't already). After you've created an account, log in and navigate to your settings. Scroll down to the "API keys" section, click "Create an API key" and then "Reveal". Copy the API key to your clipboard.</p>
<p><img data-src="/static/images/blog/django/django-coinbase/coinbase_api_keys.png" loading="lazy" class="lazyload" style="max-width:100%" alt="Coinbase API keys" src="./Accepting Crypto Payments with Django and Coinbase _ TestDriven.io_files/coinbase_api_keys.png"></p>
<p>Then add the key to the <em>settings.py</em> file:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># core/settings.py</span>

<span class="n">COINBASE_COMMERCE_API_KEY</span> <span class="o">=</span> <span class="s1">'&lt;your coinbase api key here&gt;'</span>
</code></pre></div>

<p>Before moving to the next step, let's test if we can retrieve data from the API. Enter the Python shell using the following command:</p>
<div class="codehilite"><pre><span></span><code><span class="o">(</span>env<span class="o">)</span>$ python manage.py shell
</code></pre></div>

<p>Import the following:</p>
<div class="codehilite"><pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">core</span> <span class="kn">import</span> <span class="n">settings</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">coinbase_commerce.client</span> <span class="kn">import</span> <span class="n">Client</span>
</code></pre></div>

<p>Initialize a new client and list the charges:</p>
<div class="codehilite"><pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="n">client</span> <span class="o">=</span> <span class="n">Client</span><span class="p">(</span><span class="n">api_key</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">COINBASE_COMMERCE_API_KEY</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">for</span> <span class="n">charge</span> <span class="ow">in</span> <span class="n">client</span><span class="o">.</span><span class="n">charge</span><span class="o">.</span><span class="n">list_paging_iter</span><span class="p">():</span>
<span class="o">...</span>     <span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="si">{!r}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">charge</span><span class="p">))</span>
</code></pre></div>

<p>If everything works, <code>client.charge.list_paging_iter()</code> should be an empty list. As long as you don't see the following error you can assume all is well:</p>
<div class="codehilite"><pre><span></span><code><span class="n">coinbase_commerce</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">AuthenticationError</span><span class="p">:</span> <span class="n">Request</span> <span class="nb">id</span> <span class="mi">10780</span><span class="n">b77</span><span class="o">-</span><span class="mi">1021</span><span class="o">-</span><span class="mi">4</span><span class="n">b09</span><span class="o">-</span><span class="n">b53b</span><span class="o">-</span><span class="n">a590ea044380</span><span class="p">:</span> <span class="n">No</span> <span class="n">such</span> <span class="n">API</span> <span class="n">key</span><span class="o">.</span>
</code></pre></div>

<p>Useful pages for working with the Coinbase API:</p>
<ul>
<li><a href="https://commerce.coinbase.com/docs/api/">Coinbase Commerce API</a></li>
<li><a href="https://github.com/coinbase/coinbase-commerce-python">coinbase-commerce-python</a></li>
</ul>
<p>With that, decide which approach you'd like to take, Coinbase Charges or Coinbase Checkout.</p>
<h2 id="coinbase-charges">Coinbase Charges</h2>
<blockquote>
<p>This part of the tutorial shows how to accept payments using the <a href="https://commerce.coinbase.com/docs/api/#charges">Coinbase Charges API</a>.</p>
</blockquote>
<p>Coinbase Charges is the most customizable approach for collecting crypto payments. With this approach, you have full control over the charges.</p>
<p>Workflow:</p>
<ol>
<li>Use a client to connect to the Coinbase Commerce API</li>
<li>Create a charge (from JSON)</li>
<li>Fetch the newly created charge and pass it to the template</li>
<li>Redirect the user to the Coinbase Commerce hosted site</li>
<li>(Optional) Verify the charge using webhooks</li>
</ol>
<h3 id="create-a-charge">Create a Charge</h3>
<p>To request a cryptocurrency payment, you create a <a href="https://commerce.coinbase.com/docs/api/#charges">charge</a>. Since cryptocurrency payments are <a href="https://commerce.coinbase.com/docs/#cryptocurrency-payments">push payments</a>, a charge will expire after a waiting period if no payment has been detected. Charges are identified by a unique 8 character code.</p>
<p>Update <code>home_view</code> to <a href="https://commerce.coinbase.com/docs/api/#create-a-charge">create a charge</a>:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># payments/views.py</span>

<span class="kn">from</span> <span class="nn">coinbase_commerce.client</span> <span class="kn">import</span> <span class="n">Client</span>
<span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">render</span>

<span class="kn">from</span> <span class="nn">core</span> <span class="kn">import</span> <span class="n">settings</span>


<span class="k">def</span> <span class="nf">home_view</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">client</span> <span class="o">=</span> <span class="n">Client</span><span class="p">(</span><span class="n">api_key</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">COINBASE_COMMERCE_API_KEY</span><span class="p">)</span>
    <span class="n">domain_url</span> <span class="o">=</span> <span class="s1">'http://localhost:8000/'</span>
    <span class="n">product</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">'name'</span><span class="p">:</span> <span class="s1">'Coffee'</span><span class="p">,</span>
        <span class="s1">'description'</span><span class="p">:</span> <span class="s1">'A really good local coffee.'</span><span class="p">,</span>
        <span class="s1">'local_price'</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">'amount'</span><span class="p">:</span> <span class="s1">'5.00'</span><span class="p">,</span>
            <span class="s1">'currency'</span><span class="p">:</span> <span class="s1">'USD'</span>
        <span class="p">},</span>
        <span class="s1">'pricing_type'</span><span class="p">:</span> <span class="s1">'fixed_price'</span><span class="p">,</span>
        <span class="s1">'redirect_url'</span><span class="p">:</span> <span class="n">domain_url</span> <span class="o">+</span> <span class="s1">'success/'</span><span class="p">,</span>
        <span class="s1">'cancel_url'</span><span class="p">:</span> <span class="n">domain_url</span> <span class="o">+</span> <span class="s1">'cancel/'</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="n">charge</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">charge</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="o">**</span><span class="n">product</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">'home.html'</span><span class="p">,</span> <span class="p">{</span>
        <span class="s1">'charge'</span><span class="p">:</span> <span class="n">charge</span><span class="p">,</span>
    <span class="p">})</span>
</code></pre></div>

<p>We first initialized the client by passing <code>COINBASE_COMMERCE_API_KEY</code> to it. Then, we created a JSON object which represents our product (we provided the name, description, etc.). We also passed <code>redirect_url</code> and <code>cancel_url</code> to the charge, which we'll implement here shortly. We then unpacked the JSON object and used the client to create a charge. Finally, we passed it to the home template as context.</p>
<p>We can now access charge information in <em>templates/home.html</em>. Update the template like so:</p>
<div class="codehilite"><pre><span></span><code><span class="cm">&lt;!-- templates/home.html --&gt;</span>

<span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span> <span class="na">lang</span><span class="o">=</span><span class="s">"en"</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">"utf-8"</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">name</span><span class="o">=</span><span class="s">"viewport"</span> <span class="na">content</span><span class="o">=</span><span class="s">"width=device-width, initial-scale=1"</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Django + Coinbase Charge<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">"stylesheet"</span> <span class="na">href</span><span class="o">=</span><span class="s">"https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/css/bootstrap.min.css"</span> <span class="na">crossorigin</span><span class="o">=</span><span class="s">"anonymous"</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">"https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/js/bootstrap.min.js"</span> <span class="na">crossorigin</span><span class="o">=</span><span class="s">"anonymous"</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">"container mt-5"</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">"card w-25"</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">"card-body"</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">h5</span> <span class="na">class</span><span class="o">=</span><span class="s">"card-title"</span><span class="p">&gt;</span>{{ charge.name }}<span class="p">&lt;/</span><span class="nt">h5</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">p</span> <span class="na">class</span><span class="o">=</span><span class="s">"card-text"</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">span</span><span class="p">&gt;</span>{{ charge.description }}<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">br</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">span</span><span class="p">&gt;</span>${{ charge.pricing.local.amount }} {{ charge.pricing.local.currency }}<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
          <span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">a</span> <span class="na">class</span><span class="o">=</span><span class="s">"btn btn-primary w-100"</span> <span class="na">href</span><span class="o">=</span><span class="s">"{{ charge.hosted_url }}"</span><span class="p">&gt;</span>Purchase<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
          <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
      <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</code></pre></div>

<blockquote>
<p>Refer to the <a href="https://commerce.coinbase.com/docs/api/#charges">Charge API</a> documentation for all the charge-related info that you can display on the template.</p>
</blockquote>
<p>Run the development server:</p>
<div class="codehilite"><pre><span></span><code><span class="o">(</span>env<span class="o">)</span>$ python manage.py runserver
</code></pre></div>

<p><a href="http://localhost:8000/">http://localhost:8000/</a> should now look like this:</p>
<p><img data-src="/static/images/blog/django/django-coinbase/homepage_2.png" loading="lazy" class="lazyload" style="max-width:100%" alt="Django + Coinbase Home Page" src="./Accepting Crypto Payments with Django and Coinbase _ TestDriven.io_files/homepage_2.png"></p>
<p>Don't test it out yet. We'll do that shortly.</p>
<h3 id="create-the-redirect-views">Create the Redirect Views</h3>
<p>Let's implement the views for <code>redirect_url</code> and <code>cancel_url</code> that we passed to the charge.</p>
<p>Create two new views inside <em>payments/views.py</em>:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># payments/views.py</span>

<span class="k">def</span> <span class="nf">success_view</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">'success.html'</span><span class="p">,</span> <span class="p">{})</span>


<span class="k">def</span> <span class="nf">cancel_view</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">'cancel.html'</span><span class="p">,</span> <span class="p">{})</span>
</code></pre></div>

<p>Register the new views inside <em>payments/urls.py</em>:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># payments/urls.py</span>

<span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">path</span>

<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">views</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">''</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">home_view</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">'payments-home'</span><span class="p">),</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">'success/'</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">success_view</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">'payments-success'</span><span class="p">),</span> <span class="c1"># new</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">'cancel/'</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">cancel_view</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">'payments-cancel'</span><span class="p">),</span> <span class="c1"># new</span>
<span class="p">]</span>
</code></pre></div>

<p>And <em>templates/success.html</em>:</p>
<div class="codehilite"><pre><span></span><code><span class="cm">&lt;!-- templates/success.html --&gt;</span>

<span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span> <span class="na">lang</span><span class="o">=</span><span class="s">"en"</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">"utf-8"</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">name</span><span class="o">=</span><span class="s">"viewport"</span> <span class="na">content</span><span class="o">=</span><span class="s">"width=device-width, initial-scale=1"</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Django + Coinbase Charge<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">"stylesheet"</span> <span class="na">href</span><span class="o">=</span><span class="s">"https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/css/bootstrap.min.css"</span> <span class="na">crossorigin</span><span class="o">=</span><span class="s">"anonymous"</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">"https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/js/bootstrap.min.js"</span> <span class="na">crossorigin</span><span class="o">=</span><span class="s">"anonymous"</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">"container mt-5"</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>Your payment has been successful.<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</code></pre></div>

<p>And <em>templates/cancel.html</em>:</p>
<div class="codehilite"><pre><span></span><code><span class="cm">&lt;!-- templates/cancel.html --&gt;</span>

<span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span> <span class="na">lang</span><span class="o">=</span><span class="s">"en"</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">"utf-8"</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">name</span><span class="o">=</span><span class="s">"viewport"</span> <span class="na">content</span><span class="o">=</span><span class="s">"width=device-width, initial-scale=1"</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Django + Coinbase Charge<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">"stylesheet"</span> <span class="na">href</span><span class="o">=</span><span class="s">"https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/css/bootstrap.min.css"</span> <span class="na">crossorigin</span><span class="o">=</span><span class="s">"anonymous"</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">"https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/js/bootstrap.min.js"</span> <span class="na">crossorigin</span><span class="o">=</span><span class="s">"anonymous"</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">"container mt-5"</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>Your payment has been cancelled.<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</code></pre></div>

<p>Now, after the payment is confirmed, the user will be redirected to <code>redirect_url</code>. In the event that they cancel the payment (or the charge times out), they will be redirected to <code>cancel_url</code>.</p>
<h3 id="testing">Testing</h3>
<blockquote>
<p>Unfortunately, Coinbase Commerce doesn't <a href="https://commerce.coinbase.com/faq#how-do-i-test-an-integration-do-you-have-a-sandbox-account">support sandbox accounts</a> for testing, which means that you'll need to use real crypto to test your application.</p>
</blockquote>
<p>Run the server, navigate to <a href="http://localhost:8000/">http://localhost:8000/</a>, and click on the "Purchase" button. You'll be redirected to the Coinbase Commerce hosted site:</p>
<p><img data-src="/static/images/blog/django/django-coinbase/coinbase_commerce_1.png" loading="lazy" class="lazyload" style="max-width:100%" alt="Coinbase Commerce Charges" src="./Accepting Crypto Payments with Django and Coinbase _ TestDriven.io_files/coinbase_commerce_1.png"></p>
<p>When you select a cryptocurrency with which you'd like to pay, a wallet address (and a QR code) will be shown:</p>
<p><img data-src="/static/images/blog/django/django-coinbase/coinbase_pay_bitcoin.png" loading="lazy" class="lazyload" style="max-width:100%" alt="Coinbase Commerce Charges Addresses" src="./Accepting Crypto Payments with Django and Coinbase _ TestDriven.io_files/coinbase_pay_bitcoin.png"></p>
<p>You then have 60 minutes to transfer the crypto before the charge times out.</p>
<p>After you send the crypto, it will take a few minutes (depending on which cryptocurrency you use) for miners to confirm your transaction. After the transaction gets the required number of confirmations (based on the cryptocurrency), you'll be redirected to the URL associated with <code>redirect_url</code>.</p>
<p>The payments will appear in the <a href="https://commerce.coinbase.com/dashboard/payments">Commerce Dashboard</a> under "Payments":</p>
<p><img data-src="/static/images/blog/django/django-coinbase/all_payments.png" loading="lazy" class="lazyload" style="max-width:100%" alt="Coinbase Commerce Payments" src="./Accepting Crypto Payments with Django and Coinbase _ TestDriven.io_files/all_payments.png"></p>
<p>Skip down to the "Confirm Payments with Webhooks" section to learn about payment confirmation.</p>
<h2 id="coinbase-checkout">Coinbase Checkout</h2>
<blockquote>
<p>This part of the tutorial shows how to accept payments using the <a href="https://commerce.coinbase.com/docs/api/#checkouts">Coinbase Checkout API</a>. If you decided to go with Coinbase Charges, feel free to skip this section and move down to the "Confirm Payments with Webhooks" section.</p>
</blockquote>
<p>Coinbase Checkout is the easiest way to collect crypto payments with Coinbase Commerce. With this approach, charges will automatically be generated for you. This approach is appropriate when working with fixed products.</p>
<p>Workflow:</p>
<ol>
<li>Use a client to connect to the Coinbase Commerce API</li>
<li>Fetch a checkout from Coinbase Commerce API and pass it to the template</li>
<li>(Optional) Add the required HTML code to the template if dealing with embedded checkouts</li>
<li>Redirect the user to Coinbase Commerce hosted site OR use an embedded checkout</li>
<li>(Optional) Verify the charge using webhooks</li>
</ol>
<h3 id="create-a-checkout">Create a Checkout</h3>
<p>There are two ways of creating a checkout:</p>
<ol>
<li>Programmatically via the <a href="https://github.com/coinbase/coinbase-commerce-python#create">coinbase-commerce</a> library</li>
<li>Manually within the Coinbase Commerce dashboard</li>
</ol>
<p>For simplicity, we'll use the <a href="https://commerce.coinbase.com/dashboard/settings">Commerce Dashboard</a>.</p>
<p>Navigate to "Checkouts" and click "Create Checkout":</p>
<p><img data-src="/static/images/blog/django/django-coinbase/create_checkout.png" loading="lazy" class="lazyload" style="max-width:100%" alt="Coinbase Commerce Checkout" src="./Accepting Crypto Payments with Django and Coinbase _ TestDriven.io_files/create_checkout.png"></p>
<p>Click "Sell a Product". Enter the product name, description, and price. Click "Next". Under "Customer information", select "Don't collect any information". Then, click "Done.</p>
<p>Coinbase Commerce generated all the necessary HTML code that you need to add to your home template. You can see this under the "Embed" tab. To make the web application more modular and reusable, we'll fetch the checkout info in the <code>home_view</code> instead of hard coding it in the template. To do so, we first need to obtain the checkout ID by copying the hosted page URL:</p>
<p><img data-src="/static/images/blog/django/django-coinbase/checkout_details_copy.png" loading="lazy" class="lazyload" style="max-width:100%" alt="Coinbase Commerce Checkout" src="./Accepting Crypto Payments with Django and Coinbase _ TestDriven.io_files/checkout_details_copy.png"></p>
<p>The permanent link should look something like this:</p>
<div class="codehilite"><pre><span></span><code>https://commerce.coinbase.com/checkout/df2d7c68-145e-4537-86fa-1cac705eb748
</code></pre></div>

<p>We're only interested in the last segment of the URL, which represents the checkout ID:</p>
<div class="codehilite"><pre><span></span><code>df2d7c68-145e-4537-86fa-1cac705eb748
</code></pre></div>

<p>Save this inside the <em>core/settings.py</em> file like so:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># core/settings.py</span>

<span class="n">COINBASE_CHECKOUT_ID</span> <span class="o">=</span> <span class="s1">'&lt;your checkout id&gt;'</span>
</code></pre></div>

<p>Update <em>payments/views.py</em>:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># payments/views.py</span>

<span class="kn">from</span> <span class="nn">coinbase_commerce.client</span> <span class="kn">import</span> <span class="n">Client</span>
<span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">render</span>

<span class="kn">from</span> <span class="nn">core</span> <span class="kn">import</span> <span class="n">settings</span>


<span class="k">def</span> <span class="nf">home_view</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">client</span> <span class="o">=</span> <span class="n">Client</span><span class="p">(</span><span class="n">api_key</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">COINBASE_COMMERCE_API_KEY</span><span class="p">)</span>
    <span class="n">checkout</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">checkout</span><span class="o">.</span><span class="n">retrieve</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">COINBASE_CHECKOUT_ID</span><span class="p">)</span>
    <span class="n">checkout_link</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">'https://commerce.coinbase.com/checkout/</span><span class="si">{</span><span class="n">checkout</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s1">'</span>

    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">'home.html'</span><span class="p">,</span> <span class="p">{</span>
        <span class="s1">'checkout'</span><span class="p">:</span> <span class="n">checkout</span><span class="p">,</span>
        <span class="s1">'checkout_link'</span><span class="p">:</span> <span class="n">checkout_link</span><span class="p">,</span>
    <span class="p">})</span>
</code></pre></div>

<p>This code fetches the checkout and passes it to the template.</p>
<p>Finally, we need to modify the home template to use the checkout. You can either use a:</p>
<ol>
<li>Hosted page - the user gets redirected to a Coinbase Checkout website</li>
<li>Embedded page - everything happens on your website</li>
</ol>
<p>For educational purposes, we'll use both approaches.</p>
<p>Update <em>templates/home.html</em>:</p>
<div class="codehilite"><pre><span></span><code><span class="cm">&lt;!-- templates/home.html --&gt;</span>

<span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span> <span class="na">lang</span><span class="o">=</span><span class="s">"en"</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">"utf-8"</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">name</span><span class="o">=</span><span class="s">"viewport"</span> <span class="na">content</span><span class="o">=</span><span class="s">"width=device-width, initial-scale=1"</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Django + Coinbase Checkout<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">"stylesheet"</span> <span class="na">href</span><span class="o">=</span><span class="s">"https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/css/bootstrap.min.css"</span> <span class="na">crossorigin</span><span class="o">=</span><span class="s">"anonymous"</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">"https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/js/bootstrap.min.js"</span> <span class="na">crossorigin</span><span class="o">=</span><span class="s">"anonymous"</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">"container mt-5"</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">"card w-25"</span><span class="p">&gt;</span>
        <span class="cm">&lt;!-- Coinbase checkout details --&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">"card-body"</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">h5</span> <span class="na">class</span><span class="o">=</span><span class="s">"card-title"</span><span class="p">&gt;</span>{{ checkout.name }}<span class="p">&lt;/</span><span class="nt">h5</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">p</span> <span class="na">class</span><span class="o">=</span><span class="s">"card-text"</span><span class="p">&gt;</span>
            {{ checkout.description }}<span class="p">&lt;</span><span class="nt">br</span><span class="p">&gt;</span>
            {{ checkout.local_price.amount }} {{ checkout.local_price.currency }}
          <span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
            <span class="cm">&lt;!-- Coinbase hosted approach (script not required) --&gt;</span>
            <span class="p">&lt;</span><span class="nt">a</span> <span class="na">class</span><span class="o">=</span><span class="s">"btn btn-primary w-100"</span> <span class="na">href</span><span class="o">=</span><span class="s">"{{ checkout_link }}"</span><span class="p">&gt;</span>Purchase (hosted)<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
            <span class="cm">&lt;!-- Coinbase embedded approach (script required) --&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">"mt-2"</span><span class="p">&gt;</span>
              <span class="p">&lt;</span><span class="nt">a</span> <span class="na">class</span><span class="o">=</span><span class="s">"btn btn-primary buy-with-crypto w-100"</span> <span class="na">href</span><span class="o">=</span><span class="s">"{{ checkout_link }}"</span><span class="p">&gt;</span>Purchase (embedded)<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
              <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">"https://commerce.coinbase.com/v1/checkout.js?version=201807"</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
          <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
      <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</code></pre></div>

<p>Run the server and navigate to <a href="http://localhost:8000/">http://localhost:8000/</a>:</p>
<p><img data-src="/static/images/blog/django/django-coinbase/coinbase_checkout.png" loading="lazy" class="lazyload" style="max-width:100%" alt="Coinbase Commerce Checkout Example" src="./Accepting Crypto Payments with Django and Coinbase _ TestDriven.io_files/coinbase_checkout.png"></p>
<p>The application is completely functional at this point. Don't test anything just yet though. We'll do that in the next section.</p>
<h3 id="testing_1">Testing</h3>
<blockquote>
<p>Unfortunately, Coinbase Commerce doesn't <a href="https://commerce.coinbase.com/faq#how-do-i-test-an-integration-do-you-have-a-sandbox-account">support sandbox accounts</a> for testing, which means that you'll need to use real crypto to test your application.</p>
</blockquote>
<p>With the server running, navigate to <a href="http://localhost:8000/">http://localhost:8000/</a>. You can test using the Coinbase hosted site or the embedded checkout. Your choice.</p>
<p>When you select a cryptocurrency with which you'd like to pay, a wallet address (and a QR code) will be shown:</p>
<p><img data-src="/static/images/blog/django/django-coinbase/coinbase_pay_bitcoin.png" loading="lazy" class="lazyload" style="max-width:100%" alt="Coinbase Commerce Charges Addresses" src="./Accepting Crypto Payments with Django and Coinbase _ TestDriven.io_files/coinbase_pay_bitcoin.png"></p>
<p>You then have 60 minutes to transfer the crypto before the charge times out.</p>
<p>After you send the crypto, it will take a few minutes (depending on which cryptocurrency you use) for miners to confirm your transaction. After the transaction gets the required number of confirmations (based on the cryptocurrency), you'll be presented with a "Payment complete" message.</p>
<p>The payments will appear in the <a href="https://commerce.coinbase.com/dashboard/payments">Commerce Dashboard</a> under "Payments":</p>
<p><img data-src="/static/images/blog/django/django-coinbase/all_payments.png" loading="lazy" class="lazyload" style="max-width:100%" alt="Coinbase Commerce Payments" src="./Accepting Crypto Payments with Django and Coinbase _ TestDriven.io_files/all_payments.png"></p>
<h2 id="confirm-payments-with-webhooks">Confirm Payments with Webhooks</h2>
<p>Our app works well at this point, but we can't programmatically confirm payments yet. We just redirect the user to the success page after they check out, but we can't rely on that page alone since payment confirmation happens asynchronously.</p>
<blockquote>
<p>You often deal with two different types of events when programming: Synchronous events, which have an immediate effect and results (e.g., creating a charge), and asynchronous events, which don't have an immediate result (e.g., confirming payments). Because payment confirmation is done asynchronously, the user might get redirected to the success page <em>before</em> their payment is confirmed and <em>before</em> we receive their funds.</p>
</blockquote>
<p>To get notified when the payment goes through, you need to create a <a href="https://commerce.coinbase.com/docs/api/#webhooks">webhook</a>. We'll need to create a simple endpoint in our application, which Coinbase Commerce will call whenever an event occurs (i.e., when a charge is confirmed). By using webhooks, we can be sure the payment went through successfully.</p>
<p>In order to use webhooks, we need to:</p>
<ol>
<li>Set up the webhook endpoint in the application</li>
<li>Register the endpoint in the Coinbase Commerce Dashboard</li>
</ol>
<h3 id="configure-the-endpoint">Configure the Endpoint</h3>
<p>Create a <code>coinbase_webhook</code> view in <em>payments/views.py</em>:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># payments/views.py</span>

<span class="nd">@csrf_exempt</span>
<span class="nd">@require_http_methods</span><span class="p">([</span><span class="s1">'POST'</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">coinbase_webhook</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

    <span class="n">request_data</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">'utf-8'</span><span class="p">)</span>
    <span class="n">request_sig</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'X-CC-Webhook-Signature'</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">webhook_secret</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">COINBASE_COMMERCE_WEBHOOK_SHARED_SECRET</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">event</span> <span class="o">=</span> <span class="n">Webhook</span><span class="o">.</span><span class="n">construct_event</span><span class="p">(</span><span class="n">request_data</span><span class="p">,</span> <span class="n">request_sig</span><span class="p">,</span> <span class="n">webhook_secret</span><span class="p">)</span>

        <span class="c1"># List of all Coinbase webhook events:</span>
        <span class="c1"># https://commerce.coinbase.com/docs/api/#webhooks</span>

        <span class="k">if</span> <span class="n">event</span><span class="p">[</span><span class="s1">'type'</span><span class="p">]</span> <span class="o">==</span> <span class="s1">'charge:confirmed'</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">'Payment confirmed.'</span><span class="p">)</span>
            <span class="c1"># TODO: run some custom code here</span>

    <span class="k">except</span> <span class="p">(</span><span class="n">SignatureVerificationError</span><span class="p">,</span> <span class="n">WebhookInvalidPayload</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="mi">400</span><span class="p">)</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">'Received event: id=</span><span class="si">{</span><span class="n">event</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s1">, type=</span><span class="si">{</span><span class="n">event</span><span class="o">.</span><span class="n">type</span><span class="si">}</span><span class="s1">'</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="s1">'ok'</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
</code></pre></div>

<p>This block of code validates the signature and the payload of the request and then generates an event out of it. You can now check the event type and perform different actions based on the type.</p>
<p>Update the imports:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="nn">logging</span>

<span class="kn">from</span> <span class="nn">coinbase_commerce.client</span> <span class="kn">import</span> <span class="n">Client</span>
<span class="kn">from</span> <span class="nn">coinbase_commerce.error</span> <span class="kn">import</span> <span class="n">SignatureVerificationError</span><span class="p">,</span> <span class="n">WebhookInvalidPayload</span>
<span class="kn">from</span> <span class="nn">coinbase_commerce.webhook</span> <span class="kn">import</span> <span class="n">Webhook</span>
<span class="kn">from</span> <span class="nn">django.http</span> <span class="kn">import</span> <span class="n">HttpResponse</span>
<span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">render</span>
<span class="kn">from</span> <span class="nn">django.views.decorators.csrf</span> <span class="kn">import</span> <span class="n">csrf_exempt</span>
<span class="kn">from</span> <span class="nn">django.views.decorators.http</span> <span class="kn">import</span> <span class="n">require_http_methods</span>

<span class="kn">from</span> <span class="nn">core</span> <span class="kn">import</span> <span class="n">settings</span>
</code></pre></div>

<blockquote>
<p>Ignore the error that <code>COINBASE_COMMERCE_WEBHOOK_SHARED_SECRET</code> doesn't exist yet. We'll add it in the next step.</p>
</blockquote>
<p>Register the URL in <em>payments/urls.py</em>:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># payments/urls.py</span>

<span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">path</span>

<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">views</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">''</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">home_view</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">'payments-home'</span><span class="p">),</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">'success/'</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">success_view</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">'payments-success'</span><span class="p">),</span>   <span class="c1"># only for the Coinbase charges approach</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">'cancel/'</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">cancel_view</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">'payments-cancel'</span><span class="p">),</span>      <span class="c1"># only for the Coinbase charges approach</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">'webhook/'</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">coinbase_webhook</span><span class="p">),</span>  <span class="c1"># new</span>
<span class="p">]</span>
</code></pre></div>

<p>The <code>coinbase_webhook</code> view now serves as our webhook endpoint to which Coinbase Commerce will send events to when they occur.</p>
<blockquote>
<p>If you followed the Coinbase Checkout approach, don't include the <code>success/</code> or <code>cancel/</code> URLs.</p>
</blockquote>
<h3 id="identify-the-user">Identify the User</h3>
<p>To identify the user in your webhook, you need to pass some metadata when creating the charge or when starting the checkout session. You'll then be able to fetch this metadata inside your webhook.</p>
<p>The manner in which you pass metadata is different depending on which approach you used:</p>
<ol>
<li><strong>Charges API</strong> - you'll have to attach metadata to the product</li>
<li><strong>Checkout API</strong> - you'll have to pass metadata as an HTML attribute</li>
</ol>
<h4 id="identify-the-user-with-the-charges-api">Identify the User with the Charges API</h4>
<p>To identify the user with the Charges API start by adding the following to the <code>product</code> dict inside <code>home_view</code>:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># payments/views.py</span>

<span class="n">product</span> <span class="o">=</span> <span class="p">{</span>
    <span class="o">...</span>
    <span class="s1">'metadata'</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">'customer_id'</span><span class="p">:</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">id</span> <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">is_authenticated</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
        <span class="s1">'customer_username'</span><span class="p">:</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">username</span> <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">is_authenticated</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="o">...</span>
<span class="p">}</span>
</code></pre></div>

<p>This block of code attaches the user ID and username from the authenticated user.</p>
<p>You can now access the metadata inside the <code>coinbase_webhook</code> view like so:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># payments/views.py</span>

<span class="nd">@csrf_exempt</span>
<span class="nd">@require_http_methods</span><span class="p">([</span><span class="s1">'POST'</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">coinbase_webhook</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

    <span class="n">request_data</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">'utf-8'</span><span class="p">)</span>
    <span class="n">request_sig</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'X-CC-Webhook-Signature'</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">webhook_secret</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">COINBASE_COMMERCE_WEBHOOK_SHARED_SECRET</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">event</span> <span class="o">=</span> <span class="n">Webhook</span><span class="o">.</span><span class="n">construct_event</span><span class="p">(</span><span class="n">request_data</span><span class="p">,</span> <span class="n">request_sig</span><span class="p">,</span> <span class="n">webhook_secret</span><span class="p">)</span>

        <span class="c1"># List of all Coinbase webhook events:</span>
        <span class="c1"># https://commerce.coinbase.com/docs/api/#webhooks</span>

        <span class="k">if</span> <span class="n">event</span><span class="p">[</span><span class="s1">'type'</span><span class="p">]</span> <span class="o">==</span> <span class="s1">'charge:confirmed'</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">'Payment confirmed.'</span><span class="p">)</span>
            <span class="n">customer_id</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="s1">'data'</span><span class="p">][</span><span class="s1">'metadata'</span><span class="p">][</span><span class="s1">'customer_id'</span><span class="p">]</span> <span class="c1"># new</span>
            <span class="n">customer_username</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="s1">'data'</span><span class="p">][</span><span class="s1">'metadata'</span><span class="p">][</span><span class="s1">'customer_username'</span><span class="p">]</span> <span class="c1"># new</span>
            <span class="c1"># TODO: run some custom code here</span>
            <span class="c1"># you can also use 'customer_id' or 'customer_username'</span>
            <span class="c1"># to fetch an actual Django user</span>

    <span class="k">except</span> <span class="p">(</span><span class="n">SignatureVerificationError</span><span class="p">,</span> <span class="n">WebhookInvalidPayload</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="mi">400</span><span class="p">)</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">'Received event: id=</span><span class="si">{</span><span class="n">event</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s1">, type=</span><span class="si">{</span><span class="n">event</span><span class="o">.</span><span class="n">type</span><span class="si">}</span><span class="s1">'</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="s1">'ok'</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
</code></pre></div>

<h4 id="identify-the-user-with-the-checkout-api">Identify the User with the Checkout API</h4>
<p>To identify the user with the Checkout API we need to add the metadata as a <code>data-custom</code> data attribute to the anchors in <em>templates/home.html</em>:</p>
<p>For example:</p>
<div class="codehilite"><pre><span></span><code><span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="cm">&lt;!-- Coinbase hosted approach (script not required) --&gt;</span>
  <span class="p">&lt;</span><span class="nt">a</span>
    <span class="na">class</span><span class="o">=</span><span class="s">"btn btn-primary w-100"</span>
    <span class="err">{%</span> <span class="na">if</span> <span class="na">user</span><span class="err">.</span><span class="na">is_authenticated</span> <span class="err">%}</span><span class="na">data-custom</span><span class="o">=</span><span class="s">"{{ user.pk }}"</span><span class="err">{%</span> <span class="na">endif</span> <span class="err">%}</span>
    <span class="na">href</span><span class="o">=</span><span class="s">"{{ checkout_link }}"</span>
  <span class="p">&gt;</span>Purchase (hosted)<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
  <span class="cm">&lt;!-- Coinbase embedded approach (script required) --&gt;</span>
  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">"mt-2"</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">a</span>
      <span class="na">class</span><span class="o">=</span><span class="s">"btn btn-primary buy-with-crypto w-100"</span>
      <span class="err">{%</span> <span class="na">if</span> <span class="na">user</span><span class="err">.</span><span class="na">is_authenticated</span> <span class="err">%}</span><span class="na">data-custom</span><span class="o">=</span><span class="s">"{{ user.pk }}"</span><span class="err">{%</span> <span class="na">endif</span> <span class="err">%}</span>
      <span class="na">href</span><span class="o">=</span><span class="s">"{{ checkout_link }}"</span>
    <span class="p">&gt;</span>Purchase (embedded)<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">"https://commerce.coinbase.com/v1/checkout.js?version=201807"</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</code></pre></div>

<p>You can then retrieve the metadata inside the <code>coinbase_webhook</code> view like so:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># payments/views.py</span>

<span class="nd">@csrf_exempt</span>
<span class="nd">@require_http_methods</span><span class="p">([</span><span class="s1">'POST'</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">coinbase_webhook</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">logging</span>

    <span class="n">request_data</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">'utf-8'</span><span class="p">)</span>
    <span class="n">request_sig</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'X-CC-Webhook-Signature'</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">webhook_secret</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">COINBASE_COMMERCE_WEBHOOK_SHARED_SECRET</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">event</span> <span class="o">=</span> <span class="n">Webhook</span><span class="o">.</span><span class="n">construct_event</span><span class="p">(</span><span class="n">request_data</span><span class="p">,</span> <span class="n">request_sig</span><span class="p">,</span> <span class="n">webhook_secret</span><span class="p">)</span>

        <span class="c1"># List of all Coinbase webhook events:</span>
        <span class="c1"># https://commerce.coinbase.com/docs/api/#webhooks</span>

        <span class="k">if</span> <span class="n">event</span><span class="p">[</span><span class="s1">'type'</span><span class="p">]</span> <span class="o">==</span> <span class="s1">'charge:confirmed'</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">'Payment confirmed.'</span><span class="p">)</span>
            <span class="n">customer_id</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="s1">'data'</span><span class="p">][</span><span class="s1">'metadata'</span><span class="p">][</span><span class="s1">'custom'</span><span class="p">]</span> <span class="c1"># new</span>
            <span class="c1"># TODO: run some custom code here</span>
            <span class="c1"># you can also use 'customer_id'</span>
            <span class="c1"># to fetch an actual Django user</span>

    <span class="k">except</span> <span class="p">(</span><span class="n">SignatureVerificationError</span><span class="p">,</span> <span class="n">WebhookInvalidPayload</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="mi">400</span><span class="p">)</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">'Received event: id=</span><span class="si">{</span><span class="n">event</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s1">, type=</span><span class="si">{</span><span class="n">event</span><span class="o">.</span><span class="n">type</span><span class="si">}</span><span class="s1">'</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="s1">'ok'</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
</code></pre></div>

<blockquote>
<p>Keep in mind that the webhook receives <code>data-custom</code> as plain text. Be sure to parse it to an integer before using it to fetch the user from the database.</p>
</blockquote>
<h3 id="register-the-endpoint">Register the Endpoint</h3>
<p>Navigate to <a href="https://commerce.coinbase.com/dashboard/settings">https://commerce.coinbase.com/dashboard/settings</a>, scroll down to "Webhook subscriptions" and click on "Add an endpoint":</p>
<p><img data-src="/static/images/blog/django/django-coinbase/coinbase_add_endpoint.png" loading="lazy" class="lazyload" style="max-width:100%" alt="Coinbase Commerce Webhook" src="./Accepting Crypto Payments with Django and Coinbase _ TestDriven.io_files/coinbase_add_endpoint.png"></p>
<p>Enter your endpoint URL and press "Save".</p>
<blockquote>
<p>The URL needs to start with HTTPS, which means that you need to deploy your app before you can test it.</p>
</blockquote>
<p>Next, click on "Show shared secret" and copy the secret:</p>
<p><img data-src="/static/images/blog/django/django-coinbase/coinbase_show_webhook_secret.png" loading="lazy" class="lazyload" style="max-width:100%" alt="Coinbase Commerce Webhook Secret" src="./Accepting Crypto Payments with Django and Coinbase _ TestDriven.io_files/coinbase_show_webhook_secret.png"></p>
<p>Add the shared secret to the <em>settings.py</em> file like so:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># core/settings.py</span>

<span class="n">COINBASE_COMMERCE_WEBHOOK_SHARED_SECRET</span> <span class="o">=</span> <span class="s1">'&lt;your coinbase webhook secret here&gt;'</span>
</code></pre></div>

<h3 id="test-the-endpoint">Test the Endpoint</h3>
<p>With your application deployed, you can send a test webhook request from the <a href="https://commerce.coinbase.com/dashboard/settings">Commerce Dashboard</a>. Navigate to "Webhook subscriptions" and click on "Details" under the webhook endpoint:</p>
<p><img data-src="/static/images/blog/django/django-coinbase/webhook_details.png" loading="lazy" class="lazyload" style="max-width:100%" alt="Coinbase Commerce Webhook Details" src="./Accepting Crypto Payments with Django and Coinbase _ TestDriven.io_files/webhook_details.png"></p>
<p>Then click "Send Test":</p>
<p><img data-src="/static/images/blog/django/django-coinbase/webhook_test.png" loading="lazy" class="lazyload" style="max-width:100%" alt="Coinbase Commerce Webhook Details Test" src="./Accepting Crypto Payments with Django and Coinbase _ TestDriven.io_files/webhook_test.png"></p>
<p>Finally, select the "charge:confirmed" and click on "Send Test" again. You should see the "Payment has been successful." log message.</p>
<h2 id="conclusion">Conclusion</h2>
<p>In this tutorial, you learned how to accept crypto payments with Coinbase Commerce. You should now be able to integrate it with Django and verify payments via a webhook.</p>
<p>You can find the code in the following repos on GitHub:</p>
<ol>
<li><a href="https://github.com/testdrivenio/django-coinbase-charges">django-coinbase-charges</a></li>
<li><a href="https://github.com/testdrivenio/django-coinbase-checkout">django-coinbase-checkout</a></li>
</ol>
  </div>

  <nav class="blog-topics">
    <div class="topics-list">
  <i class="fas fa-tags fa-sm"></i>
  
  <a class="btn btn-light btn-xs topic" href="https://testdriven.io/blog/topics/django/">
    Django
  </a>
  
</div>

  </nav>

  <footer class="blog-detail-footer">
    
      <article class="author-card ">
  
    <h2 class="author-card-name">
      <a href="https://testdriven.io/authors/tomazic/">Nik Tomazic</a>
    </h2>

    <a href="https://testdriven.io/authors/tomazic/" class="author-card-photo-wrap">
      <img class="author-card-photo" src="./Accepting Crypto Payments with Django and Coinbase _ TestDriven.io_files/tomazic.png" alt="Nik Tomazic">
    </a>
  

    <div class="author-card-bio">
      <p>Nik is a software developer from Slovenia. He's interested in object-oriented programming and web development. He likes learning new things and accepting new challenges. When he's not coding, Nik's either swimming or watching movies.</p>
    </div>

    <ul class="author-card-social-links">
      
      
        <li>
          <a href="https://github.com/duplxey" aria-label="GitHub">
            <i class="fab fa-github" aria-hidden="true"></i>
          </a>
        </li>
      
      
      
        <li>
          <a href="https://duplxey.com/" aria-label="Personal Site">
            <i class="fas fa-globe" aria-hidden="true"></i>
          </a>
        </li>
      
    </ul>
  </article>

    

    <div id="divContributors">
    <section class="blog-contributors">
      <h2 class="eyebrow blog-contributors-heading">Contributors</h2>
      <ul class="blog-contributors-list">
  
       <li>
         <a href="https://testdriven.io/authors/herman/" class="author-line big">
           <img src="./Accepting Crypto Payments with Django and Coinbase _ TestDriven.io_files/herman.png" alt="Michael Herman" class="author-line-photo rounded-circle">
            Michael Herman
          </a>
        </li>
    
    </ul>
    </section>
  </div>

    <h2 class="eyebrow mb-0">Share this tutorial</h2>
    
    
    
      <section class="social-share">
  <h2 class="social-share-heading sr-only">Share this tutorial</h2>
  <ul>
    <li>
      
        <a class="btn social-share-link twitter" href="https://twitter.com/intent/tweet/?text=Accepting%20Crypto%20Payments%20with%20Django%20and%20Coinbase%20from%20%40TestDrivenio&amp;url=https%3A//testdriven.io/blog/django-coinbase/" target="_blank" rel="noopener" aria-label="Twitter" data-a-social-share="Twitter">
        <span aria-hidden="true">
          <i class="fab fa-twitter"></i>
          <span class="label">Twitter</span>
        </span>
      </a>
      
    </li>

    <li>
      <a class="btn social-share-link reddit" href="https://reddit.com/submit/?url=https%3A//testdriven.io/blog/django-coinbase/&amp;resubmit=true&amp;title=Accepting%20Crypto%20Payments%20with%20Django%20and%20Coinbase" target="_blank" rel="noopener" aria-label="Reddit" data-a-social-share="Reddit">
        <span aria-hidden="true">
          <i class="fab fa-reddit-alien"></i>
          <span class="label">Reddit</span>
        </span>
      </a>
    </li>

    <li>
      <a class="btn social-share-link hackernews" href="https://news.ycombinator.com/submitlink?u=https%3A//testdriven.io/blog/django-coinbase/&amp;t=Accepting%20Crypto%20Payments%20with%20Django%20and%20Coinbase" target="_blank" rel="noopener" aria-label="Hacker News" data-a-social-share="HackerNews">
        <span aria-hidden="true">
          <i class="fab fa-hacker-news"></i>
          <span class="label">Hacker News</span>
        </span>
      </a>
    </li>

    <li>
      <a class="btn social-share-link facebook" href="https://facebook.com/sharer/sharer.php?u=https%3A//testdriven.io/blog/django-coinbase/" target="_blank" rel="noopener" aria-label="Facebook" data-a-social-share="Facebook">
          <span aria-hidden="true">
          <i class="fab fa-facebook-square" aria-hidden="true"></i>
          <span class="label">Facebook</span>
          </span>
      </a>
    </li>
  </ul>
</section>

    
    
    

    <div id="divRevisionHistory"></div>

  </footer>

      </div>
      <div class="col col-12 col-lg-4 blog-sidebar-col">
        <div class="blog-sidebar" data-a-section="Sidebar">
            
              
                


<section class="course-card portrait ">
  <span class="badge">Featured Course</span>
  <h2 class="course-card-heading"><a href="https://testdriven.io/courses/tdd-django/">Test-Driven Development with Django, Django REST Framework, and Docker</a></h2>

  <p class="course-card-description">In this course, you'll learn how to set up a development environment with Docker in order to build and deploy a RESTful API powered by Python, Django, and Django REST Framework.</p>

  <div class="course-card-actions">
    <a href="https://testdriven.io/payments/tdd-django/" class="btn btn-brand1 listing-btn" data-a-buy-course-cta="tdd-django">Buy Now <span class="listing-btn-price">$30</span></a>
    <a href="https://testdriven.io/courses/tdd-django/" class="action-link">View Course</a>
  </div>
</section>


              

              <span id="BlogSidebarStickyTop"></span>

              
                <aside class="card-sidebar search" role="search">
  <form class="search-form" action="https://testdriven.io/blog/search/" method="post">
    <input type="hidden" name="csrfmiddlewaretoken" value="q1i8eAouMIVhyHwOrfrhiBxA5W8zL4Al9fk553QVFQii05Xrr1PPBklVZCFee89m">
    <div class="form-group">
      <input type="search" class="form-control search-field" placeholder="Search all tutorials" name="search_term" required="">
    </div>
  </form>
</aside>

              

              
                <aside class="card-sidebar all-topics">
  <h3 class="eyebrow">Tutorial Topics</h3>
  <nav class="topics-list">
    
    <a class="btn btn-light btn-xs topic" href="https://testdriven.io/blog/topics/api/">API</a>
    
    <a class="btn btn-light btn-xs topic" href="https://testdriven.io/blog/topics/architecture/">Architecture</a>
    
    <a class="btn btn-light btn-xs topic" href="https://testdriven.io/blog/topics/aws/">AWS</a>
    
    <a class="btn btn-light btn-xs topic" href="https://testdriven.io/blog/topics/devops/">DevOps</a>
    
    <a class="btn btn-light btn-xs topic" href="https://testdriven.io/blog/topics/django/">Django</a>
    
    <a class="btn btn-light btn-xs topic" href="https://testdriven.io/blog/topics/django-rest-framework/">Django REST Framework</a>
    
    <a class="btn btn-light btn-xs topic" href="https://testdriven.io/blog/topics/docker/">Docker</a>
    
    <a class="btn btn-light btn-xs topic" href="https://testdriven.io/blog/topics/fastapi/">FastAPI</a>
    
    <a class="btn btn-light btn-xs topic" href="https://testdriven.io/blog/topics/flask/">Flask</a>
    
    <a class="btn btn-light btn-xs topic" href="https://testdriven.io/blog/topics/front-end/">Front-end</a>
    
    <a class="btn btn-light btn-xs topic" href="https://testdriven.io/blog/topics/heroku/">Heroku</a>
    
    <a class="btn btn-light btn-xs topic" href="https://testdriven.io/blog/topics/kubernetes/">Kubernetes</a>
    
    <a class="btn btn-light btn-xs topic" href="https://testdriven.io/blog/topics/machine-learning/">Machine Learning</a>
    
    <a class="btn btn-light btn-xs topic" href="https://testdriven.io/blog/topics/python/">Python</a>
    
    <a class="btn btn-light btn-xs topic" href="https://testdriven.io/blog/topics/react/">React</a>
    
    <a class="btn btn-light btn-xs topic" href="https://testdriven.io/blog/topics/task-queue/">Task Queue</a>
    
    <a class="btn btn-light btn-xs topic" href="https://testdriven.io/blog/topics/testing/">Testing</a>
    
    <a class="btn btn-light btn-xs topic" href="https://testdriven.io/blog/topics/vue/">Vue</a>
    
    <a class="btn btn-light btn-xs topic" href="https://testdriven.io/blog/topics/web-scraping/">Web Scraping</a>
    
  </nav>
</aside>

              

              

              <div class="blog-sidebar-sticky" id="BlogSidebarStickyBot">
                
                  <aside class="card-sidebar blog-toc">
  <h3 class="eyebrow blog-toc-heading">Table of Contents</h3>
  <nav class="local-nav">
    <ol data-local-nav-list="" id="blog-toc"><li class=""><a href="https://testdriven.io/blog/django-coinbase/#what-is-coinbase-commerce">What is Coinbase Commerce?</a></li><li class=""><a href="https://testdriven.io/blog/django-coinbase/#project-setup" class="dropdown-toggle toggle-toc-0">Project Setup</a><ul style="display: none;">
<li class=""><a href="https://testdriven.io/blog/django-coinbase/#django-project-setup">Django Project Setup</a></li>
<li class=""><a href="https://testdriven.io/blog/django-coinbase/#add-coinbase-commerce">Add Coinbase Commerce</a></li>
</ul>
</li><li class=""><a href="https://testdriven.io/blog/django-coinbase/#coinbase-charges" class="dropdown-toggle toggle-toc-1">Coinbase Charges</a><ul style="display: none;">
<li class=""><a href="https://testdriven.io/blog/django-coinbase/#create-a-charge">Create a Charge</a></li>
<li class=""><a href="https://testdriven.io/blog/django-coinbase/#create-the-redirect-views">Create the Redirect Views</a></li>
<li class=""><a href="https://testdriven.io/blog/django-coinbase/#testing">Testing</a></li>
</ul>
</li><li class="active"><a href="https://testdriven.io/blog/django-coinbase/#coinbase-checkout" class="dropdown-toggle toggle-toc-2">Coinbase Checkout</a><ul style="">
<li class=""><a href="https://testdriven.io/blog/django-coinbase/#create-a-checkout">Create a Checkout</a></li>
<li><a href="https://testdriven.io/blog/django-coinbase/#testing_1">Testing</a></li>
</ul>
</li><li><a href="https://testdriven.io/blog/django-coinbase/#confirm-payments-with-webhooks" class="dropdown-toggle toggle-toc-3">Confirm Payments with Webhooks</a><ul style="display: none;">
<li><a href="https://testdriven.io/blog/django-coinbase/#configure-the-endpoint">Configure the Endpoint</a></li>
<li><a href="https://testdriven.io/blog/django-coinbase/#identify-the-user">Identify the User</a></li>
<li><a href="https://testdriven.io/blog/django-coinbase/#register-the-endpoint">Register the Endpoint</a></li>
<li><a href="https://testdriven.io/blog/django-coinbase/#test-the-endpoint">Test the Endpoint</a></li>
</ul>
</li><li><a href="https://testdriven.io/blog/django-coinbase/#conclusion">Conclusion</a></li></ol>
  </nav>
</aside>

                

                
                  


<section class="course-card portrait " style="display: block;">
  <span class="badge">Featured Course</span>
  <h2 class="course-card-heading"><a href="https://testdriven.io/courses/tdd-django/">Test-Driven Development with Django, Django REST Framework, and Docker</a></h2>

  <p class="course-card-description">In this course, you'll learn how to set up a development environment with Docker in order to build and deploy a RESTful API powered by Python, Django, and Django REST Framework.</p>

  <div class="course-card-actions">
    <a href="https://testdriven.io/payments/tdd-django/" class="btn btn-brand1 listing-btn" data-a-buy-course-cta="tdd-django">Buy Now <span class="listing-btn-price">$30</span></a>
    <a href="https://testdriven.io/courses/tdd-django/" class="action-link">View Course</a>
  </div>
</section>


                
              </div>
            
        </div>
      </div>
    </div>
  </div>

  
<div class="related-listings" id="RelatedListings">
  <div class="container">
    <div class="row">
      <div class="col col-12">
        <h2 class="eyebrow">Recommended Tutorials</h2>
      </div>
    </div>
    <div id="spinner-loader" class="text-center" style="display: none;">
      <i class="fa fa-spinner fa-pulse fa-3x fa-fw" style="color:#797979;"></i>
      <span class="sr-only">Loading...</span>
    </div>
    <div class="row" id="RelatedListingsBody">
      <div class="col col-12 col-lg-4 mb-4">
    <article class="blog-listing">
      <header class="blog-listing-header">
        <h1 class="blog-listing-heading">
          <a href="https://testdriven.io/blog/django-stripe-tutorial">Django Stripe Tutorial</a>
        </h1>
      </header>

      <ul class="blog-listing-meta">
        <li class="blog-listing-author">
          <span class="sr-only">Posted by</span>&nbsp;
          <a href="https://testdriven.io/authors/herman" class="author-line">
            <img src="./Accepting Crypto Payments with Django and Coinbase _ TestDriven.io_files/herman.png" alt="Michael Herman" class="author-line-photo rounded-circle">
              Michael Herman
          </a>
        </li>

        <li class="blog-listing-date">
          <span class="sr-only">Last updated on</span>
          <time>Jul 30th, 2023</time>
        </li>
      </ul>

      <div class="blog-listing-body">
        <p>Quickly add Stripe to accept payments on a Django/Python website.</p>
      </div>

      <div class="topics-list">
        <i class="fas fa-tags fa-sm"></i>
        <a class="btn btn-light btn-xs topic" href="https://testdriven.io/blog/topics/django/">
            Django
          </a>
          
      </div>
    </article></div>
      <div class="col col-12 col-lg-4 mb-4">
    <article class="blog-listing">
      <header class="blog-listing-header">
        <h1 class="blog-listing-heading">
          <a href="https://testdriven.io/blog/django-stripe-subscriptions">Django Stripe Subscriptions</a>
        </h1>
      </header>

      <ul class="blog-listing-meta">
        <li class="blog-listing-author">
          <span class="sr-only">Posted by</span>&nbsp;
          <a href="https://testdriven.io/authors/tomazic" class="author-line">
            <img src="./Accepting Crypto Payments with Django and Coinbase _ TestDriven.io_files/tomazic.png" alt="Nik Tomazic" class="author-line-photo rounded-circle">
              Nik Tomazic
          </a>
        </li>

        <li class="blog-listing-date">
          <span class="sr-only">Last updated on</span>
          <time>Jul 18th, 2022</time>
        </li>
      </ul>

      <div class="blog-listing-body">
        <p>This tutorial looks at how to handle subscription payments with Django and Stripe.</p>
      </div>

      <div class="topics-list">
        <i class="fas fa-tags fa-sm"></i>
        <a class="btn btn-light btn-xs topic" href="https://testdriven.io/blog/topics/django/">
            Django
          </a>
          
      </div>
    </article></div>
      <div class="col col-12 col-lg-4 mb-4">
    <article class="blog-listing">
      <header class="blog-listing-header">
        <h1 class="blog-listing-heading">
          <a href="https://testdriven.io/blog/dockerizing-django-with-postgres-gunicorn-and-nginx">Dockerizing Django with Postgres, Gunicorn, and Nginx</a>
        </h1>
      </header>

      <ul class="blog-listing-meta">
        <li class="blog-listing-author">
          <span class="sr-only">Posted by</span>&nbsp;
          <a href="https://testdriven.io/authors/herman" class="author-line">
            <img src="./Accepting Crypto Payments with Django and Coinbase _ TestDriven.io_files/herman.png" alt="Michael Herman" class="author-line-photo rounded-circle">
              Michael Herman
          </a>
        </li>

        <li class="blog-listing-date">
          <span class="sr-only">Last updated on</span>
          <time>Jul 27th, 2023</time>
        </li>
      </ul>

      <div class="blog-listing-body">
        <p>This tutorial details how to configure Django to run on Docker along with Postgres, Nginx, and Gunicorn.</p>
      </div>

      <div class="topics-list">
        <i class="fas fa-tags fa-sm"></i>
        <a class="btn btn-light btn-xs topic" href="https://testdriven.io/blog/topics/django/">
            Django
          </a>
          <a class="btn btn-light btn-xs topic" href="https://testdriven.io/blog/topics/docker/">
            Docker
          </a>
          
      </div>
    </article></div>
    </div>
  </div>
</div>

</main>

<div class="signup-ribbon" role="banner">
  <div class="container">
    <div class="row justify-content-center">
      <div class="col-12 col-md-8">
        <header class="signup-ribbon-header">
          <h2 class="signup-ribbon-heading">Stay Sharp with Course Updates</h2>
          <p class="lead">Join our mailing list to be notified about updates and new releases.</p>
        </header>

        <form action="https://testdriven.us17.list-manage.com/subscribe/post?u=bea5ac664532063fe8aa8d6a2&amp;id=eddaf58c2a" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="signup-ribbon-form validate" target="_blank" novalidate="">
          <div class="signup-ribbon-row">
            <input placeholder="Enter your email" id="first_name" type="email" name="EMAIL" class="form-control">
            <button class="btn btn-success btn-hollow" type="submit" name="action" data-a-newsletter-sub="">Subscribe</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>




    

    <!-- Footer -->
    
      

<footer class="footer ">
  <div class="container">
    <div class="row footer-main">
      <div class="col col-12 col-lg-8">
        <nav class="footer-nav">
          <ul>
            <li>
              <span class="footer-nav-heading">Learn</span>
              <ul>
                <li>
                  <a href="https://testdriven.io/courses/">Courses</a>
                </li>
                <li>
                  <a href="https://testdriven.io/bundles/">Bundles</a>
                </li>
                <li>
                  <a href="https://testdriven.io/blog/">Blog</a>
                </li>
              </ul>
            </li>

            <li>
              <span class="footer-nav-heading">Guides</span>
              <ul>
                <li><a href="https://testdriven.io/guides/complete-python/">Complete Python</a></li>
                <li><a href="https://testdriven.io/guides/django-celery/">Django and Celery</a></li>
                <li><a href="https://testdriven.io/guides/flask-deep-dive/">Deep Dive Into Flask</a></li>
              </ul>
            </li>

            <li>
              <span class="footer-nav-heading">About TestDriven.io</span>
              <ul>
                <li><a href="https://testdriven.io/support/">Support and Consulting</a></li>
                <li><a href="https://testdriven.io/test-driven-development/">What is Test-Driven Development?</a></li>
                <li><a href="https://testdriven.io/testimonials/">Testimonials</a></li>
                <li><a href="https://testdriven.io/opensource/">Open Source Donations</a></li>
                <li><a href="https://testdriven.io/about/">About Us</a></li>
                <li><a href="https://testdriven.io/authors/">Meet the Authors</a></li>
                <li><a href="https://testdriven.io/tips/">Tips and Tricks</a></li>
              </ul>
            </li>
          </ul>
        </nav>
      </div>

      <div class="col col-sm-12 col-lg-4">
        <div class="donation-blurb">

          <div class="donation-blurb-header">
            <i class="fa fa-heart"></i>
            <h3 class="donation-blurb-heading">TestDriven.io is a proud supporter of open source</h3>
          </div>

          <p>
            <strong>10% of profits</strong> from each of our <a href="https://testdriven.io/courses/topics/fastapi/">FastAPI</a> courses and our <a href="https://testdriven.io/courses/learn-flask/">Flask Web Development</a> course will be donated to the FastAPI and Flask teams, respectively.
            <br>
          </p>

          <a href="https://testdriven.io/opensource/" class="action-link">Follow our contributions</a>
        </div>
      </div>
    </div>

    <div class="row footer-secondary">
      <div class="col col-12 col-lg-9">
        <small class="copyright">
          <p>
            <span>© Copyright 2017 - 2023 TestDriven Labs.</span>
            <br>
            <span>Developed by </span>
            <a href="http://mherman.org/">Michael Herman</a>.
          </p></small><p><small class="copyright">
        </small>

        </p><div>
          <iframe id="twitter-widget-0" scrolling="no" frameborder="0" allowtransparency="true" allowfullscreen="true" class="twitter-follow-button twitter-follow-button-rendered" style="position: static; visibility: visible; width: 153px; height: 20px;" title="Twitter Follow Button" src="./Accepting Crypto Payments with Django and Coinbase _ TestDriven.io_files/follow_button.2b2d73daf636805223fb11d48f3e94f7.en.html" data-screen-name="testdrivenio"></iframe>
          <script async="" src="./Accepting Crypto Payments with Django and Coinbase _ TestDriven.io_files/widgets.js.download" charset="utf-8"></script>
        </div>
      </div>

      <div class="col col-12 col-lg-3 footer-logo-block">
        <img src="./Accepting Crypto Payments with Django and Coinbase _ TestDriven.io_files/test_driven_io_full_logo_white_text.4a6302a91a54.svg" alt="testdriven.io" height="38">
      </div>
    </div>
  </div>
</footer>

    

    <!-- JavaScript -->
    

<script src="./Accepting Crypto Payments with Django and Coinbase _ TestDriven.io_files/jquery-3.3.1.min.js.download" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
<script src="./Accepting Crypto Payments with Django and Coinbase _ TestDriven.io_files/popper.min.js.download" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
<script src="./Accepting Crypto Payments with Django and Coinbase _ TestDriven.io_files/bootstrap.min.js.download" integrity="sha384-o+RDsa0aLu++PJvFqy8fFScvbHFLtbvScb8AjopnFD+iEQ7wo/CG0xlczd+2O/em" crossorigin="anonymous"></script>
<script src="./Accepting Crypto Payments with Django and Coinbase _ TestDriven.io_files/utils.9c5895000f5e.js.download"></script>

    

  <script>
    if ('loading' in HTMLImageElement.prototype) {
      const images = document.querySelectorAll('img[loading="lazy"]');
      images.forEach(img => {
        img.src = img.dataset.src;
      });
    } else {
      // Dynamically import the LazySizes library
      const script = document.createElement('script');
      script.src = 'https://cdnjs.cloudflare.com/ajax/libs/lazysizes/5.2.0/lazysizes.min.js';
      document.body.appendChild(script);
    }
  </script>

  <script src="./Accepting Crypto Payments with Django and Coinbase _ TestDriven.io_files/jquery.waypoints.min.7d05f92297de.js.download"></script>
  <script async="" src="./Accepting Crypto Payments with Django and Coinbase _ TestDriven.io_files/local-nav.361896821d8c.js.download"></script>
  <script async="" src="./Accepting Crypto Payments with Django and Coinbase _ TestDriven.io_files/blog-related-posts.57781d2e9f47.js.download"></script>
  <script async="" src="./Accepting Crypto Payments with Django and Coinbase _ TestDriven.io_files/blog-sticky-cta.1b87193fa49b.js.download"></script>


<script>
  const postId = 55;
  let relatedShown = false;

  const tables = document.querySelectorAll('.blog-content table');
  tables.forEach((table) => {
    let tableWrap = document.createElement('div');
    tableWrap.setAttribute('class', 'table-responsive');
    table.after(tableWrap);

    tableWrap = table.nextElementSibling;
    tableWrap.append(table);
  });
</script>


    <!-- Feedback Form -->
    <script async="" src="./Accepting Crypto Payments with Django and Coinbase _ TestDriven.io_files/feedback.c16aa6025d83.js.download"></script>
    <script>
  var generated_csrf_token = 'q1i8eAouMIVhyHwOrfrhiBxA5W8zL4Al9fk553QVFQii05Xrr1PPBklVZCFee89m';
</script>

<div class="feedback-btn">
  <button type="button" class="btn btn-dark" data-toggle="modal" data-target="#feedbackModal">Feedback</button>
</div>

<!-- Feedback Modal -->
<div class="modal fade" id="feedbackModal" tabindex="-1" role="dialog" aria-labelledby="feedbackModalTitle" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="feedbackModalTitle">Send Us Feedback</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">×</span>
        </button>
      </div>
      <div class="modal-body">
        <form class="send-feedback-form">
          <div class="form-group">
            <input type="email" class="form-control email-input" placeholder="Your email address" required="">
          </div>
          <div class="form-group">
            <textarea class="form-control feedback-input" rows="5" placeholder="Send us your feedback or report an issue. Please provide as much detail as possible. Thank you." required=""></textarea>
          </div>
          <div class="form-group" style="margin-bottom:2px">
            <button type="submit" class="btn btn-primary btn btn-block">Send</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<!-- Modal -->
<div class="modal fade" id="thankyouModal" tabindex="-1" role="dialog" aaria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-body">
        <div class="text-center">
          <br><h4 class="thankyou-message"></h4><br>
          <button type="button" class="btn btn-primary btn-sm" data-dismiss="modal" style="margin-bottom: 15px;">Close</button>
        </div>
      </div>
    </div>
  </div>
</div>

  

<iframe scrolling="no" frameborder="0" allowtransparency="true" src="./Accepting Crypto Payments with Django and Coinbase _ TestDriven.io_files/widget_iframe.2b2d73daf636805223fb11d48f3e94f7.html" title="Twitter settings iframe" style="display: none;"></iframe><iframe id="rufous-sandbox" scrolling="no" frameborder="0" allowtransparency="true" allowfullscreen="true" style="position: absolute; visibility: hidden; display: none; width: 0px; height: 0px; padding: 0px; border: none;" title="Twitter analytics iframe" src="./Accepting Crypto Payments with Django and Coinbase _ TestDriven.io_files/saved_resource.html"></iframe></body></html>